<?xml version="1.0" encoding="euc-kr" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.UsersDao">

	
  	
  
  	
	<!-- 관리자 입장에서 회원을 조회할때 -->
	<select id="selectAll" resultType="user">
		select USERID, UPASSWORD, UNAME, UZIPCODE, UADDRESS, UEMAIL, UTEL, UBIRTH, UEXIT, UJOINDATE, UAUTHORITY
		from users
		order by USERID desc
	</select>
	<!-- 관리자가 회원을 검색할 때 -->
	<select id="selectbyUserid" parameterType="string" resultType="user">
  		select USERID, UPASSWORD, UNAME, UZIPCODE, UADDRESS, UEMAIL, UTEL, UBIRTH, UEXIT, UJOINDATE, UAUTHORITY
  	    from users
  	    where USERID = #{userid} 
  	</select>
	
	<!-- 회원가입 (회원 추가) -->
	<insert id="userInsert" parameterType="user">
		insert into users 
		(userid, upassword, uname, uzipcode, uaddress, uemail, utel, ubirth, uexit, ujoindate, uauthority)
		values
		(#{userid},#{upassword},#{uname},#{uzipcode},#{uaddress},#{uemail},#{utel},#{ubirth},#{uexit},#{ujoindate},#{uauthority})
	</insert>
	<!-- 회원탈퇴했을떄 uexit 업데이트 -->
	<update id="userStatusUpdate" parameterType="string">
		update users set
		UEXIT=#{uexit}
		where USERID=#{userid}
	</update>
	
	<!-- 회원정보 수정 했을 때 -->
	<update id="userUpdate" parameterType="user" >
		<!-- 비밀번호만 수정했을 때 -->
		<if test="uaddress == null and utel == null">
			update users set
			UPASSWORD=#{upassword}
			where USERID=#{userid}
		</if>
		
		<!-- 주소만 수정했을 때 -->
		<if test="upassword == null and utel == null">
			update users set
			UADDRESS=#{uaddress}
			where USERID=#{userid}
		</if>
		<!-- 전화번호만 수정했을 때 -->
		<if test="uaddress == null and upassword == null">
			update users set
			UTEL=#{utel}
			where USERID=#{userid}
		</if>
		<!-- 비밀번호, 주소 수정했을 때 -->
		<if test="utel == null">
			update users set
			UPASSWORD=#{upassword}
			UADDRESS=#{uaddress}
			where USERID=#{userid}
		</if>
		<!-- 비밀번호, 전화 수정했을 때 -->
		<if test="uaddress == null">
			update users set
			UPASSWORD=#{upassword}
			UTEL=#{utel}
			where USERID=#{userid}
		</if>
		<!-- 주소, 전화 수정했을 때 -->
		<if test="upassword == null">
			update users set
			UADDRESS=#{uaddress}
			UTEL=#{utel}
			where USERID=#{userid}
		</if>
		<!-- 모두 수정했을 때 -->
		<if test="uaddress != null and utel != null and upassword != null">
			update users set
			UPASSWORD=#{upassword}
			UADDRESS=#{uaddress}
			UTEL=#{utel}
			where USERID=#{userid}
		</if>
		
	</update>

</mapper>